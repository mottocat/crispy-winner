<%= @product.usage_manifests.with_status(:using).count %> users using this product now,
<br>

<%= @product.usage_manifests.with_status(:used).count %> users used this product before.
<br>

<% if user_signed_in? && (um = current_user.usage_manifest_for(@product)) %>
  
  I <%=  um.using? ? "am using" : "used to use" %> 
  this product. 

  <%= link_to "Cancel",
              [@product, :usage_manifests],
              method: :delete %>

<% else %>

  <%= form_for [@product, UsageManifest.find_or_initialize_by(product: @product, user: current_user)] do |f| %>
    
    I
    
    <%= f.select :status, 
                  # UsageManifest.statuses.keys,
                  [["am using", "using"], ["used to use", "used"]],
                  include_blank: true %>

    this product.

    <% if user_signed_in? %>
      <%= f.submit "Save" %>
    <% else %>
      <%= f.submit "Save", disabled: true %>      
    <% end %>

  <% end %>

<% end %>

<p>
  <strong>Name:</strong>
  <%= @product.name %>
</p>

<p>
  <strong>Brand:</strong>
  <%= @product.brand %>
</p>

<%= link_to 'Edit', edit_product_path(@product) %> |
<%= link_to 'Back', products_path %>
<%= link_to 'Comments', product_comments_path(@product) %>